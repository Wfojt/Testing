<!DOCTYPE html>
<html>
  <head>
    <title>Marketplace Table</title>
    <style>
      table {
        font-family: Arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td,
      th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
      }

      tr:nth-child(even) {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Marketplace</th>
          <th>Ships From</th>
          <th>Feedback</th>
          <th>Appraisal Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">5</td>
          <td contenteditable="true">$1.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">0</td>
          <td contenteditable="true">$50.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">5</td>
          <td contenteditable="true">$0.50</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">0</td>
          <td contenteditable="true">$0.45</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true">Just Launched</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.25</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon US</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">Just Launched</td>
          <td contenteditable="true">$0.35</td>
        </tr>
        <tr>
          <td contenteditable="true">Wish</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">1000</td>
          <td contenteditable="true">$0.25</td>
        </tr>
        <tr>
          <td contenteditable="true">Wish</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.20</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay US</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.25</td>
        </tr>
        <tr>
          <td contenteditable="true">DHgate</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="rue">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Aliexpress</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Alibaba</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.05</td>
        </tr>
        <tr>
          <td contenteditable="true">Tophatter</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.30</td>
        </tr>
        <tr>
          <td contenteditable="true">Shopify</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.20</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon UK</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Spain</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Ireland</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Switzerland</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay France</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Singapore</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay India</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Tophatter</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon France</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Germany</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Etsy</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Italy</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay UK</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Germany</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Australia</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Joom</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Walmart</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Italy</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Australia</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Netherlands</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Belgium</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Malaysia</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay China</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Newegg</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Japan</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Mexico</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.00</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Canada</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Spain</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Austria</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Philippines</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">eBay Hong Kong</td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.15</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Canada</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">5</td>
          <td contenteditable="true">$0.75</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Canada</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">0</td>
          <td contenteditable="true">$0.60</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Canada</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">5</td>
          <td contenteditable="true">$0.50</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Canada</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">0</td>
          <td contenteditable="true">$0.45</td>
        </tr>
        <tr>
          <td contenteditable="true">Amazon Canada</td>
          <td contenteditable="true">Just Launched</td>
          <td contenteditable="true"></td>
          <td contenteditable="true">$0.25</td>
        </tr>
        <tr>
          <td contenteditable="true"> Amazon Canada</td>
          <td contenteditable="true">FBA</td>
          <td contenteditable="true">Just Launched</td>
          <td contenteditable="true">$0.35</td>
        </tr>
      </tbody>
    </table>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function() {
            // Connect to the ElephantSQL database
            const client = new Client({
              connectionString: 'postgres://vmdsfvjc:iQOEJjyO4buznnbDE75OOlvWASMlssoK@ruby.db.elephantsql.com/vmdsfvjc'
            });
            // Get the table body element
            const tableBody = $('tbody');
            // Function to update the database when a cell is edited
            function updateDatabase(row, column, value) {
              const marketplace = row.children().eq(0).text();
              const shipsFrom = row.children().eq(1).text();
              const feedback = row.children().eq(2).text();
              const appraisalValue = row.children().eq(3).text();
              // Construct the SQL query
              const query = `UPDATE marketplace_table SET appraisal_value = '${value}' WHERE marketplace = '${marketplace}' AND ships_from = '${shipsFrom}' AND feedback = '${feedback}'`;
              // Execute the SQL query
              client.query(query, (err, res) => {
                if (err) {
                  console.log(err.stack);
                } else {
                  console.log(`Updated ${res.rowCount} row(s)`);
                }
              });
            }
            // Event listener for cell editing
            tableBody.on('input', 'td[contenteditable="true"]', function() {
              const cell = $(this);
              const row = cell.parent();
              const column = cell.index();
              const value = cell.text();
              updateDatabase(row, column, value);
            });
            // Load data from the database and populate the table
            client.connect().then(() => {
                return client.query('SELECT * FROM marketplace_table');
              }).then((res) => {
                  const rows = res.rows;
                  rows.forEach((row) => {
                        const tr = $(' < tr > ');
                            tr.append($(' < td > ').text(row.marketplace).attr('
                                contenteditable ', '
                                true '));
                                tr.append($(' < td > ').text(row.ships_from).attr('
                                  contenteditable ', '
                                  true '));
                                  tr.append($(' < td > ').text(row.feedback).attr('
                                    contenteditable ', '
                                    true '));
                                    tr.append($(' < td > ').text(row.appraisal_value).attr('
                                      contenteditable ', '
                                      true '));
                                      tableBody.append(tr);
                                    });
                                  }).catch((err) => {
                                    console.log(err.stack);
                                  });
                                });
    </script>
    <script>
      $(function() {
        // When a cell with class 'editable-cell' is edited
        $('.editable-cell').on('input', function() {
          // Get the updated value and its row ID
          const updatedValue = $(this).text();
          const rowId = $(this).closest('tr').attr('id');
          // Send the updated value and row ID to the server
          $.ajax({
            url: 'ruby.db.elephantsql.com',
            type: 'POST',
            data: {
              id: rowId,
              value: updatedValue
            },
            success: function(response) {
              console.log(response);
            },
            error: function(error) {
              console.error(error);
            }
          });
        });
      });
    </script>
  </body>
</html>
